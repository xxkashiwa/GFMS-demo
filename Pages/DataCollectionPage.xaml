<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="GFMS.Pages.DataCollectionPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:GFMS.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Resources>
        <local:StatusToColorConverter x:Key="StatusToColorConverter" />
        <local:RecordTypeToColorConverter x:Key="RecordTypeToColorConverter" />
        <local:DateToStringConverter x:Key="DateToStringConverter" />
    </Page.Resources>

    <ScrollViewer>
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!--  页面标题  -->
            <StackPanel Grid.Row="0" Margin="0,0,0,20">
                <TextBlock
                    Margin="0,0,0,10"
                    FontSize="32"
                    FontWeight="Bold"
                    Text="学生信息采集" />
                <TextBlock
                    FontSize="14"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Text="管理学生基础信息、成绩记录和奖惩信息" />
            </StackPanel>

            <!--  主要内容区域  -->
            <Grid Grid.Row="1">
                <Pivot x:Name="DataCollectionPivot">

                    <!--  基础信息标签页  -->
                    <PivotItem Header="基础信息">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!--  操作按钮区  -->
                            <StackPanel
                                Grid.Row="0"
                                Margin="0,0,0,20"
                                Orientation="Horizontal"
                                Spacing="10">
                                <Button
                                    x:Name="ImportStudentInfoButton"
                                    Content="批量导入"
                                    Style="{StaticResource AccentButtonStyle}">
                                    <Button.Flyout>
                                        <MenuFlyout>
                                            <MenuFlyoutItem Text="从Excel导入">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE8E7;" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                            <MenuFlyoutItem Text="从教务系统导入">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE896;" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                            <MenuFlyoutSeparator />
                                            <MenuFlyoutItem Text="下载模板">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE896;" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                        </MenuFlyout>
                                    </Button.Flyout>
                                </Button>
                                <Button Click="AddStudentButton_Click" Style="{StaticResource AccentButtonStyle}">
                                    <Button.Content>
                                        <StackPanel Orientation="Horizontal" Spacing="5">
                                            <FontIcon FontSize="14" Glyph="&#xE8FA;" />
                                            <TextBlock Text="新增学生" />
                                        </StackPanel>
                                    </Button.Content>
                                </Button>
                                <Button Click="ExportDataButton_Click">
                                    <Button.Content>
                                        <StackPanel Orientation="Horizontal" Spacing="5">
                                            <FontIcon FontSize="14" Glyph="&#xE72D;" />
                                            <TextBlock Text="导出数据" />
                                        </StackPanel>
                                    </Button.Content>
                                </Button>
                                <TextBox
                                    Width="250"
                                    Margin="20,0,0,0"
                                    PlaceholderText="搜索学生姓名或学号..." />
                            </StackPanel>

                            <!--  学生信息列表  -->
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="300" />
                                </Grid.ColumnDefinitions>

                                <!--  左侧列表  -->
                                <Border
                                    Grid.Column="0"
                                    Margin="0,0,10,0"
                                    Padding="0"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    CornerRadius="8">
                                    <ListView x:Name="StudentListView" SelectionMode="Single">
                                        <ListView.Header>
                                            <Grid Padding="15,10" Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="100" />
                                                    <ColumnDefinition Width="150" />
                                                    <ColumnDefinition Width="200" />
                                                    <ColumnDefinition Width="150" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock
                                                    Grid.Column="0"
                                                    FontWeight="SemiBold"
                                                    Text="学号" />
                                                <TextBlock
                                                    Grid.Column="1"
                                                    FontWeight="SemiBold"
                                                    Text="姓名" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    FontWeight="SemiBold"
                                                    Text="专业" />
                                                <TextBlock
                                                    Grid.Column="3"
                                                    FontWeight="SemiBold"
                                                    Text="班级" />
                                                <TextBlock
                                                    Grid.Column="4"
                                                    FontWeight="SemiBold"
                                                    Text="状态" />
                                            </Grid>
                                        </ListView.Header>

                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="local:StudentInfo">
                                                <Grid Padding="15,10">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="100" />
                                                        <ColumnDefinition Width="150" />
                                                        <ColumnDefinition Width="200" />
                                                        <ColumnDefinition Width="150" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock
                                                        Grid.Column="0"
                                                        VerticalAlignment="Center"
                                                        Text="{x:Bind StudentId}" />
                                                    <TextBlock
                                                        Grid.Column="1"
                                                        VerticalAlignment="Center"
                                                        Text="{x:Bind Name}" />
                                                    <TextBlock
                                                        Grid.Column="2"
                                                        VerticalAlignment="Center"
                                                        Text="{x:Bind Major}" />
                                                    <TextBlock
                                                        Grid.Column="3"
                                                        VerticalAlignment="Center"
                                                        Text="{x:Bind Class}" />
                                                    <Border
                                                        Grid.Column="4"
                                                        Padding="8,4"
                                                        HorizontalAlignment="Left"
                                                        Background="{x:Bind Status, Converter={StaticResource StatusToColorConverter}}"
                                                        CornerRadius="12">
                                                        <TextBlock
                                                            FontSize="12"
                                                            Foreground="White"
                                                            Text="{x:Bind Status}" />
                                                    </Border>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>
                                </Border>

                                <!--  右侧详情面板  -->
                                <Border
                                    Grid.Column="1"
                                    Margin="10,0,0,0"
                                    Padding="20"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    CornerRadius="8">
                                    <ScrollViewer>
                                        <StackPanel Spacing="15">
                                            <TextBlock
                                                FontSize="18"
                                                FontWeight="SemiBold"
                                                Text="学生详细信息" />

                                            <StackPanel Spacing="10">
                                                <TextBlock
                                                    FontSize="14"
                                                    FontWeight="SemiBold"
                                                    Foreground="{ThemeResource SystemAccentColor}"
                                                    Text="基本信息" />

                                                <StackPanel Spacing="8">
                                                    <TextBox Header="学号" Text="2021001" />
                                                    <TextBox Header="姓名" Text="张三" />
                                                    <ComboBox
                                                        HorizontalAlignment="Stretch"
                                                        Header="性别"
                                                        SelectedIndex="0">
                                                        <ComboBoxItem Content="男" />
                                                        <ComboBoxItem Content="女" />
                                                    </ComboBox>
                                                    <DatePicker Header="出生日期" />
                                                    <TextBox Header="身份证号" Text="" />
                                                    <TextBox Header="专业" Text="计算机科学与技术" />
                                                    <TextBox Header="班级" Text="计科2101" />
                                                    <TextBox Header="联系电话" Text="" />
                                                    <TextBox Header="邮箱地址" Text="" />
                                                </StackPanel>
                                            </StackPanel>

                                            <StackPanel Spacing="10">
                                                <TextBlock
                                                    FontSize="14"
                                                    FontWeight="SemiBold"
                                                    Foreground="{ThemeResource SystemAccentColor}"
                                                    Text="家庭信息" />

                                                <StackPanel Spacing="8">
                                                    <TextBox Header="家庭住址" Text="" />
                                                    <TextBox Header="家长姓名" Text="" />
                                                    <TextBox Header="家长联系方式" Text="" />
                                                </StackPanel>
                                            </StackPanel>

                                            <StackPanel
                                                Margin="0,20,0,0"
                                                Orientation="Horizontal"
                                                Spacing="10">
                                                <Button
                                                    Click="SaveStudentButton_Click"
                                                    Content="保存信息"
                                                    Style="{StaticResource AccentButtonStyle}" />
                                                <Button Click="DeleteStudentButton_Click" Content="删除学生" />
                                                <Button Click="ResetStudentButton_Click" Content="重置" />
                                            </StackPanel>
                                        </StackPanel>
                                    </ScrollViewer>
                                </Border>
                            </Grid>
                        </Grid>
                    </PivotItem>

                    <!--  成绩录入标签页  -->
                    <PivotItem Header="成绩录入">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!--  操作按钮区  -->
                            <StackPanel
                                Grid.Row="0"
                                Margin="0,0,0,20"
                                Orientation="Horizontal"
                                Spacing="10">
                                <Button
                                    Click="ImportGradesButton_Click"
                                    Content="批量导入成绩"
                                    Style="{StaticResource AccentButtonStyle}" />
                                <ComboBox
                                    Width="150"
                                    PlaceholderText="选择学期"
                                    SelectionChanged="SemesterComboBox_SelectionChanged">
                                    <ComboBoxItem Content="2023-2024春季" />
                                    <ComboBoxItem Content="2023-2024秋季" />
                                    <ComboBoxItem Content="2022-2023春季" />
                                    <ComboBoxItem Content="2022-2023秋季" />
                                </ComboBox>
                                <ComboBox
                                    Width="200"
                                    PlaceholderText="选择专业"
                                    SelectionChanged="MajorComboBox_SelectionChanged">
                                    <ComboBoxItem Content="计算机科学与技术" />
                                    <ComboBoxItem Content="软件工程" />
                                    <ComboBoxItem Content="网络工程" />
                                </ComboBox>
                            </StackPanel>

                            <!--  成绩表格  -->
                            <Border
                                Grid.Row="1"
                                Padding="15"
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8">
                                <ListView x:Name="GradeListView">
                                    <ListView.Header>
                                        <Grid Padding="10" Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="100" />
                                                <ColumnDefinition Width="120" />
                                                <ColumnDefinition Width="150" />
                                                <ColumnDefinition Width="80" />
                                                <ColumnDefinition Width="80" />
                                                <ColumnDefinition Width="80" />
                                                <ColumnDefinition Width="100" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock
                                                Grid.Column="0"
                                                FontWeight="SemiBold"
                                                Text="学号" />
                                            <TextBlock
                                                Grid.Column="1"
                                                FontWeight="SemiBold"
                                                Text="姓名" />
                                            <TextBlock
                                                Grid.Column="2"
                                                FontWeight="SemiBold"
                                                Text="课程名称" />
                                            <TextBlock
                                                Grid.Column="3"
                                                FontWeight="SemiBold"
                                                Text="学分" />
                                            <TextBlock
                                                Grid.Column="4"
                                                FontWeight="SemiBold"
                                                Text="成绩" />
                                            <TextBlock
                                                Grid.Column="5"
                                                FontWeight="SemiBold"
                                                Text="绩点" />
                                            <TextBlock
                                                Grid.Column="6"
                                                FontWeight="SemiBold"
                                                Text="成绩类型" />
                                            <TextBlock
                                                Grid.Column="7"
                                                FontWeight="SemiBold"
                                                Text="备注" />
                                        </Grid>
                                    </ListView.Header>

                                    <ListView.ItemTemplate>
                                        <DataTemplate x:DataType="local:GradeInfo">
                                            <Grid Padding="10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="100" />
                                                    <ColumnDefinition Width="120" />
                                                    <ColumnDefinition Width="150" />
                                                    <ColumnDefinition Width="80" />
                                                    <ColumnDefinition Width="80" />
                                                    <ColumnDefinition Width="80" />
                                                    <ColumnDefinition Width="100" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock
                                                    Grid.Column="0"
                                                    VerticalAlignment="Center"
                                                    Text="{x:Bind StudentId}" />
                                                <TextBlock
                                                    Grid.Column="1"
                                                    VerticalAlignment="Center"
                                                    Text="{x:Bind StudentName}" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    VerticalAlignment="Center"
                                                    Text="{x:Bind CourseName}" />
                                                <TextBlock
                                                    Grid.Column="3"
                                                    VerticalAlignment="Center"
                                                    Text="{x:Bind Credits}" />
                                                <TextBlock
                                                    Grid.Column="4"
                                                    VerticalAlignment="Center"
                                                    Text="{x:Bind Score}" />
                                                <TextBlock
                                                    Grid.Column="5"
                                                    VerticalAlignment="Center"
                                                    Text="{x:Bind GPA}" />
                                                <TextBlock
                                                    Grid.Column="6"
                                                    VerticalAlignment="Center"
                                                    Text="{x:Bind GradeType}" />
                                                <TextBlock
                                                    Grid.Column="7"
                                                    VerticalAlignment="Center"
                                                    Text="{x:Bind Remarks}" />
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </Border>
                        </Grid>
                    </PivotItem>

                    <!--  奖惩记录标签页  -->
                    <PivotItem Header="奖惩记录">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!--  操作按钮区  -->
                            <StackPanel
                                Grid.Row="0"
                                Margin="0,0,0,20"
                                Orientation="Horizontal"
                                Spacing="10">
                                <Button
                                    Click="AddRecordButton_Click"
                                    Content="添加记录"
                                    Style="{StaticResource AccentButtonStyle}" />
                                <Button Click="ImportRecordsButton_Click" Content="批量导入" />
                                <ComboBox
                                    Width="120"
                                    PlaceholderText="记录类型"
                                    SelectionChanged="RecordTypeComboBox_SelectionChanged">
                                    <ComboBoxItem Content="奖励" />
                                    <ComboBoxItem Content="处分" />
                                    <ComboBoxItem Content="全部" />
                                </ComboBox>
                                <ComboBox
                                    Width="120"
                                    PlaceholderText="记录级别"
                                    SelectionChanged="RecordLevelComboBox_SelectionChanged">
                                    <ComboBoxItem Content="校级" />
                                    <ComboBoxItem Content="省级" />
                                    <ComboBoxItem Content="国家级" />
                                </ComboBox>
                            </StackPanel>

                            <!--  奖惩记录列表  -->
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="350" />
                                </Grid.ColumnDefinitions>

                                <!--  记录列表  -->
                                <Border
                                    Grid.Column="0"
                                    Margin="0,0,10,0"
                                    Padding="0"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    CornerRadius="8">
                                    <ListView x:Name="RewardPunishmentListView">
                                        <ListView.Header>
                                            <Grid Padding="15,10" Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="100" />
                                                    <ColumnDefinition Width="120" />
                                                    <ColumnDefinition Width="80" />
                                                    <ColumnDefinition Width="150" />
                                                    <ColumnDefinition Width="100" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock
                                                    Grid.Column="0"
                                                    FontWeight="SemiBold"
                                                    Text="学号" />
                                                <TextBlock
                                                    Grid.Column="1"
                                                    FontWeight="SemiBold"
                                                    Text="姓名" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    FontWeight="SemiBold"
                                                    Text="类型" />
                                                <TextBlock
                                                    Grid.Column="3"
                                                    FontWeight="SemiBold"
                                                    Text="奖惩名称" />
                                                <TextBlock
                                                    Grid.Column="4"
                                                    FontWeight="SemiBold"
                                                    Text="级别" />
                                                <TextBlock
                                                    Grid.Column="5"
                                                    FontWeight="SemiBold"
                                                    Text="时间" />
                                            </Grid>
                                        </ListView.Header>

                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="local:RewardPunishmentRecord">
                                                <Grid Padding="15,10">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="100" />
                                                        <ColumnDefinition Width="120" />
                                                        <ColumnDefinition Width="80" />
                                                        <ColumnDefinition Width="150" />
                                                        <ColumnDefinition Width="100" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock
                                                        Grid.Column="0"
                                                        VerticalAlignment="Center"
                                                        Text="{x:Bind StudentId}" />
                                                    <TextBlock
                                                        Grid.Column="1"
                                                        VerticalAlignment="Center"
                                                        Text="{x:Bind StudentName}" />
                                                    <Border
                                                        Grid.Column="2"
                                                        Padding="6,2"
                                                        HorizontalAlignment="Center"
                                                        Background="{x:Bind Type, Converter={StaticResource RecordTypeToColorConverter}}"
                                                        CornerRadius="8">
                                                        <TextBlock
                                                            FontSize="11"
                                                            Foreground="White"
                                                            Text="{x:Bind Type}" />
                                                    </Border>
                                                    <TextBlock
                                                        Grid.Column="3"
                                                        VerticalAlignment="Center"
                                                        Text="{x:Bind Name}" />
                                                    <TextBlock
                                                        Grid.Column="4"
                                                        VerticalAlignment="Center"
                                                        Text="{x:Bind Level}" />
                                                    <TextBlock
                                                        Grid.Column="5"
                                                        VerticalAlignment="Center"
                                                        Text="{x:Bind Date, Converter={StaticResource DateToStringConverter}}" />
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>
                                </Border>

                                <!--  右侧添加/编辑面板  -->
                                <Border
                                    Grid.Column="1"
                                    Margin="10,0,0,0"
                                    Padding="20"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    CornerRadius="8">
                                    <ScrollViewer>
                                        <StackPanel Spacing="15">
                                            <TextBlock
                                                FontSize="18"
                                                FontWeight="SemiBold"
                                                Text="奖惩记录详情" />

                                            <StackPanel Spacing="10">
                                                <TextBox Header="学号" PlaceholderText="输入学号" />
                                                <TextBox Header="学生姓名" PlaceholderText="输入姓名" />

                                                <ComboBox HorizontalAlignment="Stretch" Header="记录类型">
                                                    <ComboBoxItem Content="奖励" />
                                                    <ComboBoxItem Content="处分" />
                                                </ComboBox>

                                                <TextBox Header="奖惩名称" PlaceholderText="如：三好学生、优秀毕业生等" />

                                                <ComboBox HorizontalAlignment="Stretch" Header="记录级别">
                                                    <ComboBoxItem Content="校级" />
                                                    <ComboBoxItem Content="市级" />
                                                    <ComboBoxItem Content="省级" />
                                                    <ComboBoxItem Content="国家级" />
                                                </ComboBox>

                                                <DatePicker Header="获得时间" />

                                                <TextBox Header="颁发机构" PlaceholderText="如：学校、教育部等" />

                                                <TextBox
                                                    Height="80"
                                                    AcceptsReturn="True"
                                                    Header="详细描述"
                                                    PlaceholderText="详细描述奖惩内容" />

                                                <StackPanel>
                                                    <TextBlock Margin="0,0,0,5" Text="证书文件" />
                                                    <Button Click="SelectFileButton_Click">
                                                        <StackPanel Orientation="Horizontal" Spacing="5">
                                                            <FontIcon FontSize="14" Glyph="&#xE723;" />
                                                            <TextBlock Text="选择文件" />
                                                        </StackPanel>
                                                    </Button>
                                                </StackPanel>
                                            </StackPanel>

                                            <StackPanel
                                                Margin="0,20,0,0"
                                                Orientation="Horizontal"
                                                Spacing="10">
                                                <Button
                                                    Click="SaveRecordButton_Click"
                                                    Content="保存记录"
                                                    Style="{StaticResource AccentButtonStyle}" />
                                                <Button Click="DeleteRecordButton_Click" Content="删除" />
                                                <Button Click="ClearRecordButton_Click" Content="清空" />
                                            </StackPanel>
                                        </StackPanel>
                                    </ScrollViewer>
                                </Border>
                            </Grid>
                        </Grid>
                    </PivotItem>
                </Pivot>
            </Grid>
        </Grid>
    </ScrollViewer>
</Page>